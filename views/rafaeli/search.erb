<%
  search_val     = pr[:q].to_s.downcase

  #search_val = 'javascript' unless val.present?
  all_sellers = $users.all(type: 'seller').reverse

  fields = [:title, :location, :desc, :rate] 
  users  = all_sellers.select {|u| 
    text = fields.map {|f| " "+u[f].to_s }.join(' ')
    u[:text] = text
    search_val && text.downcase.include?(search_val.to_s) 
  }
  # users   = all_sellers # .select {|u| val && u.to_s.include?(val.to_s) }
  results = users

  # results = [
  #   {name: 'Sella Rafaeli', title: 'Expert Fullstack Architect', location: 'Tel Aviv', desc: 'Really nice guy.', rate: '$10k-30k USD/mo'}
  # ]


# bp

x=1 

%>

<style>
:root {
  --color1: rgb(26, 13, 171);
}
.main_search_wrapper {
  zmargin-bottom: 10px;
}
.main_search {
  border-radius: 0px;
}
.single_result {
  zbackground-color: whitesmoke;
  padding:5px 10px;
  margin-bottom: 30px;
  display: flex;
}
.name {
  font-weight: bold;
}
.top_row {
  font-size: 14px;
}
.title {
  zcolor: rgb(26, 13, 171);
  color: var(--color1);
  margin:7px 0 3px 0;
  display: block;
  font-size: 20px;
}
.location {
  font-size: 14px;
  color: #746e6e;
}
.desc {
  color: rgb(77, 81, 86);
  font-size: 14px;
}
.rate {
  margin-top: 10px;
}
.img_container {
  display: flex;
  justify-content: center;
  align-items: center;
}
.img_container img {
  object-fit: contain;
  width: 100%;
  max-height: 100px;
}
.bottom_link {
  color: rgb(26, 13, 171);
  font-size: 14px;
}
.search_results_wrapper {
  max-width: 900px;
  margin: auto;
  margin-top: 20px;
}
</style>


<div class='main_search_wrapper ct'>
  <form method=get action=search>
    <input name=q class='main_search input1' placeholder='search...' value="<%=search_val%>" autocomplete />
    <button class='btn btn-raised btn-primary'>go </button>
  </form>
</div>

<style>
.keywords {
  max-width: 800px;
  margin: auto;
  text-align: center;
}
.single_keyword {
  display: inline-block;
  zcolor: var(--color1);
  color: grey;
  text-transform: lowercase;
  font-size: 13px;
  margin: 0 10px;
}
</style>

<div class='keywords'>
<%  
  all_opts = {
    frontend: ['react', 'vue', 'angular', 'ember', 'vanilla'],
    backend:  ['java', 'c++', 'python', 'node', 'go', 'ruby'],
    fullstack: ['express', 'rails', 'django', 'laravel'],
    mobile: ['ios', 'android', 'swift', 'flutter'],
    devops: ['aws', 'gcp', 'azure', 'heroku']
  }.hwia

  opts = all_opts[search_val] || all_opts.keys
  

  keywords = opts
  keywords.each do |keyword|
%>
  <a class='single_keyword <%="selected_val" if search_val==keyword%>' href='/search?q=<%=keyword%>'><%=keyword%></a>
<% end %>
</div>

<div class='search_results_wrapper'>
<% if results.any? %>
  <% results.each do |res| %>
    <div class='single_result'>
      <div class='left_half flex6'>
        <div class='top_row'>
          <span class='name'><%=res[:name]%></span>
          <% if res[:location] %>
          <span class='location' style='display: inline-block; margin-left: 10px'> â€º <%=res[:location].to_s.downcase %></span>
          <% end %>
        </div>
        <div class='title'>      
          <% if res[:title].present? %><span class='title'><%=res[:title]%></span> <% end %>
          
        </div>
        <div class='desc'>
          <%= res[:desc] %>
        </div>

        <div class='bottom_links'>
          <% if res[:rate] %><div class='rate bottom_link'><%= res[:rate] %></div><% end %>    
        </div>
      </div>
      <% if false %>
      <div class='right_half img_container flex1' style='zborder:1px solid red; text-align: right'>
        <% if res[:img_url].present? %>
        <img src='<%=res[:img_url]%>' />
        <% end %>
      </div>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div class='no_results ct'>
    <br/>
    <h5> 
      Oh, sorry. Nobody available for that right now. 
      <br/>
      <br/>
      We're still in alpha, launching early '23. 
      <br/>
      <br/>
      You can <button>make a request</button> for us to source such talent for you. It's free. 
    </h5>
  </div>
<% end %>
</div>